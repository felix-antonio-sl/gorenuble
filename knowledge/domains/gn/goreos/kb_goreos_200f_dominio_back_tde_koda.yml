# GOS-200f: GORE_OS - Modelo de Datos: Dominios Back-Office y TDE
# ═══════════════════════════════════════════════════════════════════════════════

Manifest:
  URN: "urn:knowledge:gorenuble:goreos:200f:modelo_datos:d_back_tde"
  Version: "1.0.0"
  Status: Draft

Metadata:
  Title: "GORE_OS - Modelo de Datos: D-BACK + D-TDE"
  Description: "Detalle de entidades de Back-Office (5) y TDE (5)"
  Domain: GORE_OS
  Created: "2024-12-14"
  Tags: [goreos, modelo_datos, d_back, d_tde, expediente]

# ═══════════════════════════════════════════════════════════════════════════════
# D-BACK: BACK-OFFICE
# ═══════════════════════════════════════════════════════════════════════════════

DocumentoOficial:
  _meta:
    dominio: D-BACK
    tabla: documentos_oficiales
  atributos:
    id: { tipo: UUID, pk: true }
    tipo: { tipo: "Enum[RESOLUCION,DECRETO,OFICIO,MEMORANDUM,CIRCULAR,CERTIFICADO,INFORME,ACTA,OTRO]" }
    numero: { tipo: String(30), not_null: true }
    anio: { tipo: Integer, not_null: true }
    fecha: { tipo: Date, not_null: true }
    asunto: { tipo: String(500), not_null: true }
    unidad_emisora_id: { tipo: "FK(unidades_organicas.id)" }
    firmante_id: { tipo: "FK(funcionarios.id)", nullable: true }
    estado: { tipo: "Enum[BORRADOR,EN_REVISION,PARA_FIRMA,FIRMADO,DISTRIBUIDO,ANULADO]" }
    expediente_id: { tipo: "FK(expedientes_electronicos.id)", nullable: true }
    documento_url: { tipo: String(500), nullable: true }
    firmado_electronico: { tipo: Boolean, default: false }
    created_at: { tipo: DateTime, auto: true }
  indices:
    - { campos: [tipo, numero, anio], tipo: unique }

OrdenCompra:
  _meta:
    dominio: D-BACK
    tabla: ordenes_compra
  atributos:
    id: { tipo: UUID, pk: true }
    numero: { tipo: String(30), unique: true }
    proveedor_id: { tipo: "FK(actores.id)" }
    proveedor_rut: { tipo: String(12) }
    proveedor_nombre: { tipo: String(255) }
    descripcion: { tipo: String(500) }
    monto_neto: { tipo: Decimal(18,0) }
    monto_iva: { tipo: Decimal(18,0), default: 0 }
    monto_total: { tipo: Decimal(18,0) }
    fecha_emision: { tipo: Date }
    estado: { tipo: "Enum[EMITIDA,ACEPTADA,EN_PROCESO,RECIBIDA,PAGADA,ANULADA]" }
    unidad_solicitante_id: { tipo: "FK(unidades_organicas.id)" }
    url_mercado_publico: { tipo: String(500), nullable: true }
    created_at: { tipo: DateTime, auto: true }

Factura:
  _meta:
    dominio: D-BACK
    tabla: facturas
  atributos:
    id: { tipo: UUID, pk: true }
    tipo: { tipo: "Enum[FACTURA,FACTURA_ELECTRONICA,NOTA_CREDITO,NOTA_DEBITO]" }
    numero: { tipo: String(30) }
    proveedor_rut: { tipo: String(12) }
    proveedor_nombre: { tipo: String(255) }
    fecha_emision: { tipo: Date }
    monto_neto: { tipo: Decimal(18,0) }
    monto_iva: { tipo: Decimal(18,0) }
    monto_total: { tipo: Decimal(18,0) }
    estado: { tipo: "Enum[RECIBIDA,EN_REVISION,APROBADA,EN_PAGO,PAGADA,RECHAZADA,ANULADA]" }
    orden_compra_id: { tipo: "FK(ordenes_compra.id)", nullable: true }
    fecha_pago: { tipo: Date, nullable: true }
    created_at: { tipo: DateTime, auto: true }
  indices:
    - { campos: [proveedor_rut, numero], tipo: unique }

ActivoFijo:
  _meta:
    dominio: D-BACK
    tabla: activos_fijos
  atributos:
    id: { tipo: UUID, pk: true }
    codigo: { tipo: String(30), unique: true }
    descripcion: { tipo: String(500) }
    categoria: { tipo: "Enum[MOBILIARIO,EQUIPO_COMPUTACIONAL,VEHICULO,MAQUINARIA,INMUEBLE,OTRO]" }
    marca: { tipo: String(100), nullable: true }
    modelo: { tipo: String(100), nullable: true }
    numero_serie: { tipo: String(100), nullable: true }
    valor_adquisicion: { tipo: Decimal(18,0) }
    valor_libro: { tipo: Decimal(18,0), nullable: true }
    fecha_adquisicion: { tipo: Date }
    vida_util_meses: { tipo: Integer, nullable: true }
    ubicacion: { tipo: String(200), nullable: true }
    responsable_id: { tipo: "FK(funcionarios.id)", nullable: true }
    estado: { tipo: "Enum[OPERATIVO,EN_REPARACION,DADO_DE_BAJA,EXTRAVIADO]", default: OPERATIVO }
    created_at: { tipo: DateTime, auto: true }

Inventario:
  _meta:
    dominio: D-BACK
    tabla: inventario
  atributos:
    id: { tipo: UUID, pk: true }
    codigo: { tipo: String(30), unique: true }
    descripcion: { tipo: String(500) }
    categoria: { tipo: String(100) }
    unidad_medida: { tipo: String(20) }
    stock_actual: { tipo: Integer, default: 0 }
    stock_minimo: { tipo: Integer, default: 0 }
    ubicacion: { tipo: String(200), nullable: true }
    activo: { tipo: Boolean, default: true }
    created_at: { tipo: DateTime, auto: true }

# ═══════════════════════════════════════════════════════════════════════════════
# D-TDE: TRANSFORMACIÓN DIGITAL
# ═══════════════════════════════════════════════════════════════════════════════

ExpedienteElectronico:
  _meta:
    dominio: D-TDE
    tabla: expedientes_electronicos
    descripcion: "Expediente administrativo electrónico (DS 10)"
  atributos:
    id: { tipo: UUID, pk: true }
    iuie: { tipo: String(50), unique: true, descripcion: "Identificador único DS 10" }
    tipo_procedimiento: { tipo: String(100) }
    materia: { tipo: String(200) }
    descripcion: { tipo: Text, nullable: true }
    fecha_creacion: { tipo: DateTime }
    fecha_cierre: { tipo: DateTime, nullable: true }
    estado: { tipo: "Enum[ABIERTO,EN_TRAMITE,CERRADO,ARCHIVADO]", default: ABIERTO }
    unidad_responsable_id: { tipo: "FK(unidades_organicas.id)" }
    funcionario_responsable_id: { tipo: "FK(funcionarios.id)", nullable: true }
    folio_actual: { tipo: Integer, default: 0 }
    created_at: { tipo: DateTime, auto: true }
    updated_at: { tipo: DateTime, auto: true }
  indices:
    - { campos: [iuie], tipo: unique }
    - { campos: [estado], tipo: btree }
  relaciones:
    documentos: { tipo: "1:N", entidad: DocumentoExpediente }
    unidad: { tipo: "N:1", entidad: UnidadOrganica }

DocumentoExpediente:
  _meta:
    dominio: D-TDE
    tabla: documentos_expediente
  atributos:
    id: { tipo: UUID, pk: true }
    expediente_id: { tipo: "FK(expedientes_electronicos.id)" }
    folio: { tipo: Integer }
    tipo: { tipo: "Enum[RESOLUCION,OFICIO,INFORME,SOLICITUD,CONTRATO,ANEXO,OTRO]" }
    numero_documento: { tipo: String(50), nullable: true }
    fecha_documento: { tipo: Date }
    asunto: { tipo: String(500) }
    archivo_url: { tipo: String(500) }
    hash_sha256: { tipo: String(64) }
    tamano_bytes: { tipo: Integer }
    firmado: { tipo: Boolean, default: false }
    firma_info: { tipo: JSONB, nullable: true }
    created_at: { tipo: DateTime, auto: true }
  indices:
    - { campos: [expediente_id, folio], tipo: unique }

SesionUsuario:
  _meta:
    dominio: D-TDE
    tabla: sesiones_usuario
  atributos:
    id: { tipo: UUID, pk: true }
    usuario_id: { tipo: "FK(usuarios.id)" }
    metodo_auth: { tipo: "Enum[CLAVEUNICA,SSO_INTERNO,LDAP]" }
    fecha_inicio: { tipo: DateTime }
    fecha_fin: { tipo: DateTime, nullable: true }
    ip_origen: { tipo: String(45) }
    user_agent: { tipo: String(500), nullable: true }
    activa: { tipo: Boolean, default: true }
    token_hash: { tipo: String(64), nullable: true }
  indices:
    - { campos: [usuario_id, activa], tipo: btree }

ServicioInteroperabilidad:
  _meta:
    dominio: D-TDE
    tabla: servicios_interoperabilidad
    descripcion: "Servicio de interop consumido/expuesto (DS 12)"
  atributos:
    id: { tipo: UUID, pk: true }
    codigo: { tipo: String(50), unique: true }
    nombre: { tipo: String(200) }
    descripcion: { tipo: Text, nullable: true }
    tipo: { tipo: "Enum[CONSUMIDOR,PROVEEDOR]" }
    protocolo: { tipo: "Enum[REST,SOAP,GRAPHQL,GRPC]", default: REST }
    endpoint: { tipo: String(500), nullable: true }
    proveedor_externo: { tipo: String(200), nullable: true }
    estado: { tipo: "Enum[ACTIVO,INACTIVO,EN_DESARROLLO,DEPRECADO]" }
    requiere_autenticacion: { tipo: Boolean, default: true }
    ultima_consulta: { tipo: DateTime, nullable: true }
    total_consultas: { tipo: Integer, default: 0 }
    created_at: { tipo: DateTime, auto: true }

RegistroTratamientoDP:
  _meta:
    dominio: D-TDE
    tabla: registros_tratamiento_dp
    descripcion: "Registro tratamiento datos personales (Ley 21.719)"
  atributos:
    id: { tipo: UUID, pk: true }
    codigo: { tipo: String(30), unique: true }
    nombre: { tipo: String(200) }
    finalidad: { tipo: Text }
    base_legal: { tipo: String(200) }
    categorias_datos: { tipo: JSONB, descripcion: "Tipos de datos tratados" }
    categorias_titulares: { tipo: JSONB, descripcion: "Tipos de titulares" }
    fuente_datos: { tipo: String(200), nullable: true }
    destinatarios: { tipo: JSONB, nullable: true }
    transferencia_internacional: { tipo: Boolean, default: false }
    pais_transferencia: { tipo: String(100), nullable: true }
    plazo_conservacion: { tipo: String(200) }
    medidas_seguridad: { tipo: Text, nullable: true }
    responsable_id: { tipo: "FK(funcionarios.id)" }
    unidad_id: { tipo: "FK(unidades_organicas.id)" }
    activo: { tipo: Boolean, default: true }
    fecha_registro: { tipo: Date }
    fecha_actualizacion: { tipo: Date, nullable: true }
    created_at: { tipo: DateTime, auto: true }
  indices:
    - { campos: [codigo], tipo: unique }

# ═══════════════════════════════════════════════════════════════════════════════
# FIN D-BACK + D-TDE
# ═══════════════════════════════════════════════════════════════════════════════
