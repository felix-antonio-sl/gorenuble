# GOS-200h: GORE_OS - Modelo de Datos: Dominio Evolución
# ═══════════════════════════════════════════════════════════════════════════════

Manifest:
  URN: "urn:knowledge:gorenuble:goreos:200h:modelo_datos:d_evol"
  Version: "1.0.0"
  Status: Draft

Metadata:
  Title: "GORE_OS - Modelo de Datos: D-EVOL (Evolución)"
  Description: "Detalle de las 10 entidades del dominio Evolución Institucional"
  Domain: GORE_OS
  Created: "2024-12-14"
  Tags: [goreos, modelo_datos, d_evol, dataset, agente_ai, automatizacion]

# ═══════════════════════════════════════════════════════════════════════════════
# D-EVOL: EVOLUCIÓN INSTITUCIONAL
# ═══════════════════════════════════════════════════════════════════════════════

Dataset:
  _meta:
    dominio: D-EVOL
    tabla: datasets
    descripcion: "Conjunto de datos en el Lakehouse"
  atributos:
    id: { tipo: UUID, pk: true }
    codigo: { tipo: String(50), unique: true }
    nombre: { tipo: String(200) }
    descripcion: { tipo: Text, nullable: true }
    dominio_origen: { tipo: String(20) }
    capa: { tipo: "Enum[BRONZE,SILVER,GOLD,SEMANTIC]" }
    tipo: { tipo: "Enum[MAESTRO,TRANSACCIONAL,ANALITICO,REFERENCIA,SNAPSHOT]" }
    formato: { tipo: "Enum[PARQUET,DELTA,ICEBERG,CSV,JSON]", default: DELTA }
    clasificacion_dp: { tipo: "Enum[PUBLICO,INTERNO,SENSIBLE,RESERVADO]", default: INTERNO }
    esquema: { tipo: JSONB, descripcion: "Schema JSON del dataset" }
    particiones: { tipo: JSONB, nullable: true }
    ubicacion: { tipo: String(500), descripcion: "Path en storage" }
    frecuencia_actualizacion: { tipo: String(50) }
    ultima_actualizacion: { tipo: DateTime, nullable: true }
    registros_aproximados: { tipo: BigInteger, nullable: true }
    tamano_bytes: { tipo: BigInteger, nullable: true }
    owner_id: { tipo: "FK(funcionarios.id)", nullable: true }
    activo: { tipo: Boolean, default: true }
    created_at: { tipo: DateTime, auto: true }
    updated_at: { tipo: DateTime, auto: true }
  indices:
    - { campos: [codigo], tipo: unique }
    - { campos: [dominio_origen, capa], tipo: btree }
    - { campos: [clasificacion_dp], tipo: btree }
  relaciones:
    servicios: { tipo: "1:N", entidad: ServicioDatos }
    linaje_origen: { tipo: "1:N", entidad: LineajeDatos, fk: "dataset_destino_id" }
    linaje_destino: { tipo: "1:N", entidad: LineajeDatos, fk: "dataset_origen_id" }

ServicioDatos:
  _meta:
    dominio: D-EVOL
    tabla: servicios_datos
    descripcion: "API o servicio que expone datos"
  atributos:
    id: { tipo: UUID, pk: true }
    codigo: { tipo: String(50), unique: true }
    nombre: { tipo: String(200) }
    descripcion: { tipo: Text, nullable: true }
    tipo: { tipo: "Enum[API_REST,GRAPHQL,EVENT_STREAM,BATCH,WEBHOOK]" }
    dataset_id: { tipo: "FK(datasets.id)", nullable: true }
    endpoint: { tipo: String(500) }
    metodo_auth: { tipo: "Enum[API_KEY,OAUTH2,JWT,NONE]", default: API_KEY }
    version: { tipo: String(10), default: "v1" }
    documentacion_url: { tipo: String(500), nullable: true }
    rate_limit: { tipo: Integer, nullable: true, descripcion: "Requests por minuto" }
    estado: { tipo: "Enum[DESARROLLO,STAGING,PRODUCCION,DEPRECADO]" }
    consumidores: { tipo: JSONB, nullable: true }
    metricas_uso: { tipo: JSONB, nullable: true }
    created_at: { tipo: DateTime, auto: true }
    updated_at: { tipo: DateTime, auto: true }
  indices:
    - { campos: [codigo], tipo: unique }
    - { campos: [dataset_id], tipo: btree }
    - { campos: [estado], tipo: btree }

Automatizacion:
  _meta:
    dominio: D-EVOL
    tabla: automatizaciones
    descripcion: "Proceso automatizado (RPA, reglas, ML, workflows)"
  atributos:
    id: { tipo: UUID, pk: true }
    codigo: { tipo: String(50), unique: true }
    nombre: { tipo: String(200) }
    descripcion: { tipo: Text, nullable: true }
    tipo: { tipo: "Enum[RPA,REGLAS,ML_PREDICCION,ML_CLASIFICACION,WORKFLOW,SCHEDULER,ETL,VALIDADOR]" }
    dominio: { tipo: String(20) }
    proceso_objetivo: { tipo: String(200), nullable: true }
    trigger: { tipo: "Enum[EVENTO,SCHEDULE,MANUAL,API,WEBHOOK]" }
    configuracion_trigger: { tipo: JSONB, nullable: true }
    parametros: { tipo: JSONB, nullable: true }
    estado: { tipo: "Enum[DISEÑO,DESARROLLO,PRUEBAS,PRODUCCION,PAUSADO,DEPRECADO]" }
    requiere_aprobacion: { tipo: Boolean, default: false }
    nivel_autonomia: { tipo: "Enum[ALTA,MEDIA,BAJA_HITL]", default: BAJA_HITL }
    owner_id: { tipo: "FK(funcionarios.id)", nullable: true }
    ultima_ejecucion: { tipo: DateTime, nullable: true }
    proxima_ejecucion: { tipo: DateTime, nullable: true }
    total_ejecuciones: { tipo: Integer, default: 0 }
    tasa_exito: { tipo: Decimal(5,2), nullable: true }
    created_at: { tipo: DateTime, auto: true }
    updated_at: { tipo: DateTime, auto: true }
  indices:
    - { campos: [codigo], tipo: unique }
    - { campos: [tipo, estado], tipo: btree }
    - { campos: [dominio], tipo: btree }
  relaciones:
    ejecuciones: { tipo: "1:N", entidad: EjecucionAutomatizacion }

EjecucionAutomatizacion:
  _meta:
    dominio: D-EVOL
    tabla: ejecuciones_automatizacion
  atributos:
    id: { tipo: UUID, pk: true }
    automatizacion_id: { tipo: "FK(automatizaciones.id)" }
    fecha_inicio: { tipo: DateTime }
    fecha_fin: { tipo: DateTime, nullable: true }
    estado: { tipo: "Enum[EN_COLA,EN_EJECUCION,COMPLETADO,FALLIDO,CANCELADO]" }
    trigger_tipo: { tipo: String(50) }
    parametros_entrada: { tipo: JSONB, nullable: true }
    resultado: { tipo: JSONB, nullable: true }
    items_procesados: { tipo: Integer, default: 0 }
    items_exitosos: { tipo: Integer, default: 0 }
    items_fallidos: { tipo: Integer, default: 0 }
    duracion_ms: { tipo: Integer, nullable: true }
    error_mensaje: { tipo: Text, nullable: true }
    error_detalle: { tipo: JSONB, nullable: true }
    ejecutado_por: { tipo: "FK(usuarios.id)", nullable: true }
    created_at: { tipo: DateTime, auto: true }
  indices:
    - { campos: [automatizacion_id, fecha_inicio], tipo: btree }
    - { campos: [estado], tipo: btree }

AgenteAI:
  _meta:
    dominio: D-EVOL
    tabla: agentes_ai
    descripcion: "Agente de inteligencia artificial"
  atributos:
    id: { tipo: UUID, pk: true }
    codigo: { tipo: String(50), unique: true }
    nombre: { tipo: String(200) }
    descripcion: { tipo: Text, nullable: true }
    tipo: { tipo: "Enum[CONVERSACIONAL,OPERACIONAL,DECISIONAL,ANALITICO]" }
    dominio: { tipo: String(20), nullable: true }
    proposito: { tipo: Text }
    modelo_base: { tipo: String(100), descripcion: "ej: gpt-4, claude-3, llama-3" }
    proveedor: { tipo: "Enum[OPENAI,ANTHROPIC,GOOGLE,LOCAL,OTRO]" }
    system_prompt: { tipo: Text, nullable: true }
    temperatura: { tipo: Decimal(3,2), default: 0.7 }
    max_tokens: { tipo: Integer, default: 4096 }
    autonomia: { tipo: "Enum[ALTA,MEDIA,BAJA_HITL]", default: BAJA_HITL }
    capacidades: { tipo: JSONB, nullable: true, descripcion: "Tools/functions disponibles" }
    restricciones: { tipo: JSONB, nullable: true }
    estado: { tipo: "Enum[DESARROLLO,PILOTO,PRODUCCION,PAUSADO,DEPRECADO]" }
    owner_id: { tipo: "FK(funcionarios.id)", nullable: true }
    total_interacciones: { tipo: Integer, default: 0 }
    satisfaccion_promedio: { tipo: Decimal(3,2), nullable: true }
    created_at: { tipo: DateTime, auto: true }
    updated_at: { tipo: DateTime, auto: true }
  indices:
    - { campos: [codigo], tipo: unique }
    - { campos: [tipo, estado], tipo: btree }
  relaciones:
    colecciones_rag: { tipo: "N:N", entidad: ColeccionRAG, through: "agentes_colecciones" }
    interacciones: { tipo: "1:N", entidad: InteraccionAgente }
    tareas: { tipo: "1:N", entidad: TareaAgente }

ColeccionRAG:
  _meta:
    dominio: D-EVOL
    tabla: colecciones_rag
    descripcion: "Colección de conocimiento para RAG"
  atributos:
    id: { tipo: UUID, pk: true }
    codigo: { tipo: String(50), unique: true }
    nombre: { tipo: String(200) }
    descripcion: { tipo: Text, nullable: true }
    tipo: { tipo: "Enum[NORMATIVA,PROCEDIMIENTOS,CONOCIMIENTO,FAQ,HISTORICO,TECNICO]" }
    dominio: { tipo: String(20), nullable: true }
    embedding_model: { tipo: String(100), default: "text-embedding-3-small" }
    vector_dimension: { tipo: Integer, default: 1536 }
    chunk_size: { tipo: Integer, default: 1000 }
    chunk_overlap: { tipo: Integer, default: 200 }
    total_documentos: { tipo: Integer, default: 0 }
    total_chunks: { tipo: Integer, default: 0 }
    ultima_indexacion: { tipo: DateTime, nullable: true }
    estado: { tipo: "Enum[CREANDO,INDEXANDO,ACTIVA,ACTUALIZANDO,DEPRECADA]" }
    created_at: { tipo: DateTime, auto: true }
    updated_at: { tipo: DateTime, auto: true }
  indices:
    - { campos: [codigo], tipo: unique }
    - { campos: [tipo, estado], tipo: btree }
  relaciones:
    documentos: { tipo: "1:N", entidad: DocumentoRAG }
    agentes: { tipo: "N:N", entidad: AgenteAI, through: "agentes_colecciones" }

DocumentoRAG:
  _meta:
    dominio: D-EVOL
    tabla: documentos_rag
  atributos:
    id: { tipo: UUID, pk: true }
    coleccion_id: { tipo: "FK(colecciones_rag.id)" }
    titulo: { tipo: String(500) }
    fuente: { tipo: String(500) }
    tipo_fuente: { tipo: "Enum[PDF,DOCX,HTML,MARKDOWN,TXT,KODA,OTRO]" }
    url_original: { tipo: String(500), nullable: true }
    contenido_hash: { tipo: String(64) }
    chunks_generados: { tipo: Integer, default: 0 }
    fecha_documento: { tipo: Date, nullable: true }
    fecha_indexacion: { tipo: DateTime }
    metadata: { tipo: JSONB, nullable: true }
    vigente: { tipo: Boolean, default: true }
    created_at: { tipo: DateTime, auto: true }
  indices:
    - { campos: [coleccion_id, contenido_hash], tipo: unique }
    - { campos: [vigente], tipo: btree }

InteraccionAgente:
  _meta:
    dominio: D-EVOL
    tabla: interacciones_agente
    descripcion: "Conversación o interacción con agente AI"
  atributos:
    id: { tipo: UUID, pk: true }
    agente_id: { tipo: "FK(agentes_ai.id)" }
    usuario_id: { tipo: "FK(usuarios.id)" }
    sesion_id: { tipo: String(50) }
    fecha_inicio: { tipo: DateTime }
    fecha_fin: { tipo: DateTime, nullable: true }
    canal: { tipo: "Enum[WEB,API,SLACK,TEAMS,WHATSAPP,OTRO]", default: WEB }
    mensajes_count: { tipo: Integer, default: 0 }
    tokens_entrada: { tipo: Integer, default: 0 }
    tokens_salida: { tipo: Integer, default: 0 }
    costo_estimado: { tipo: Decimal(10,6), default: 0 }
    contexto: { tipo: JSONB, nullable: true }
    resultado_exitoso: { tipo: Boolean, nullable: true }
    satisfaccion: { tipo: Integer, nullable: true, descripcion: "1-5" }
    feedback: { tipo: Text, nullable: true }
    created_at: { tipo: DateTime, auto: true }
  indices:
    - { campos: [agente_id, fecha_inicio], tipo: btree }
    - { campos: [usuario_id], tipo: btree }
    - { campos: [sesion_id], tipo: btree }

TareaAgente:
  _meta:
    dominio: D-EVOL
    tabla: tareas_agente
    descripcion: "Tarea ejecutada por agente operacional/decisional"
  atributos:
    id: { tipo: UUID, pk: true }
    agente_id: { tipo: "FK(agentes_ai.id)" }
    tipo_tarea: { tipo: String(100) }
    descripcion: { tipo: String(500), nullable: true }
    entrada: { tipo: JSONB }
    salida: { tipo: JSONB, nullable: true }
    estado: { tipo: "Enum[PENDIENTE,EN_EJECUCION,COMPLETADA,FALLIDA,REQUIERE_APROBACION,APROBADA,RECHAZADA]" }
    confianza: { tipo: Decimal(3,2), nullable: true }
    razonamiento: { tipo: Text, nullable: true }
    requirio_hitl: { tipo: Boolean, default: false }
    aprobador_id: { tipo: "FK(usuarios.id)", nullable: true }
    fecha_aprobacion: { tipo: DateTime, nullable: true }
    fecha_inicio: { tipo: DateTime }
    fecha_fin: { tipo: DateTime, nullable: true }
    duracion_ms: { tipo: Integer, nullable: true }
    error_mensaje: { tipo: Text, nullable: true }
    created_at: { tipo: DateTime, auto: true }
  indices:
    - { campos: [agente_id, fecha_inicio], tipo: btree }
    - { campos: [estado], tipo: btree }
    - { campos: [tipo_tarea], tipo: btree }

PoliticaAI:
  _meta:
    dominio: D-EVOL
    tabla: politicas_ai
    descripcion: "Política de gobernanza AI (HAIC)"
  atributos:
    id: { tipo: UUID, pk: true }
    codigo: { tipo: String(30), unique: true }
    nombre: { tipo: String(200) }
    tipo: { tipo: "Enum[USO_ACEPTABLE,SEGURIDAD,PRIVACIDAD,ETICA,TRANSPARENCIA,AUDITORIA]" }
    alcance: { tipo: "Enum[GLOBAL,DOMINIO,AGENTE]" }
    dominio_aplicable: { tipo: String(20), nullable: true }
    contenido: { tipo: Text }
    version: { tipo: String(10), default: "1.0" }
    fecha_vigencia: { tipo: Date }
    fecha_revision: { tipo: Date, nullable: true }
    aprobado_por: { tipo: String(200), nullable: true }
    estado: { tipo: "Enum[BORRADOR,VIGENTE,EN_REVISION,DEPRECADA]" }
    created_at: { tipo: DateTime, auto: true }
    updated_at: { tipo: DateTime, auto: true }
  indices:
    - { campos: [codigo], tipo: unique }
    - { campos: [tipo, estado], tipo: btree }

# ═══════════════════════════════════════════════════════════════════════════════
# ENTIDADES AUXILIARES D-EVOL
# ═══════════════════════════════════════════════════════════════════════════════

LineajeDatos:
  _meta:
    tabla: linaje_datos
    descripcion: "Relación de linaje entre datasets"
  atributos:
    id: { tipo: UUID, pk: true }
    dataset_origen_id: { tipo: "FK(datasets.id)" }
    dataset_destino_id: { tipo: "FK(datasets.id)" }
    tipo_transformacion: { tipo: String(100) }
    descripcion: { tipo: Text, nullable: true }
    automatizacion_id: { tipo: "FK(automatizaciones.id)", nullable: true }
    created_at: { tipo: DateTime, auto: true }

AgentesColecciones:
  _meta:
    tabla: agentes_colecciones
    descripcion: "Relación N:N entre agentes y colecciones RAG"
  atributos:
    id: { tipo: UUID, pk: true }
    agente_id: { tipo: "FK(agentes_ai.id)" }
    coleccion_id: { tipo: "FK(colecciones_rag.id)" }
    prioridad: { tipo: Integer, default: 1 }
    activo: { tipo: Boolean, default: true }
    created_at: { tipo: DateTime, auto: true }
  indices:
    - { campos: [agente_id, coleccion_id], tipo: unique }

# ═══════════════════════════════════════════════════════════════════════════════
# FIN D-EVOL
# ═══════════════════════════════════════════════════════════════════════════════
